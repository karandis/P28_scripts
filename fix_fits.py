from astropy.io import fits
from pathlib import Path
import pandas as pd

cpath = Path('/STER/karansinghd/PhD/Projects/P28_c/')


df = pd.read_csv('/STER/karansinghd/PhD/Projects/P28_c/stdinfo.csv')
df_melchiors = pd.read_csv('/STER/karansinghd/PhD/Projects/P28_c/melchiors_meta.csv',sep='|')

objects = [x.strip().replace(' ','_').replace('*','_') for x in df_melchiors.loc[df_melchiors.obsid.astype(int).isin(df.unseq)]['starname'].to_numpy()]

df = df.assign(object = objects)

stupid_unseqs = [369277, 369474, 369475, 369476, 369479, 369480, 369481, 369482, 369483, 369484, 369485, 369486, 369487, 369488, 369489, 369490, 369491, 369492, 369493, 369494, 369495, 369496, 369497, 369498, 369499, 369500, 369501, 369502, 369503, 369504, 369506, 369516, 369517, 369518, 369519, 369520, 369521, 369522, 369523, 369524, 369525, 369526, 369527, 369528, 371050, 371051, 371052, 371053, 371369, 371370, 371371, 371372, 371373, 374008, 374009, 374010, 374013, 374014, 374015, 374016, 374017, 374018, 374019, 374020, 374021, 374022, 374023, 374024, 374025, 374026, 374027, 374028, 374029, 374030, 374032, 374033, 374034, 374035, 374040, 374042, 374043, 374411, 374412, 374413, 374414, 374415, 374416, 374417, 374418, 374419, 374420, 374421, 374422, 374424, 374425, 374426, 374427, 374428, 374429, 374430, 374431, 374432, 374433, 374434, 374435, 374436, 374437, 374438, 374439, 374440, 374441, 374442, 374443, 374444, 374445, 374446, 374447, 374448, 375058, 375059, 375060, 375061, 375062, 375063, 375064, 375174, 375175, 375176, 375190, 376173, 376174, 376175, 376176, 384787, 384788, 384792, 384795, 384796, 384797, 384798, 384799, 384800, 384801, 384802, 384803, 384805, 384806, 384809, 384810, 384811, 384812, 384813, 384814, 384874, 384875, 384881, 384947, 385053, 385054, 385383, 385517, 385519, 385521, 385523, 389248, 389253, 389254, 389260, 389261, 389264, 389265, 389266, 389269, 389272, 389273, 389274, 389276, 389277, 389278, 389330, 389332, 389333, 389347, 389348, 389406, 389407, 389421, 389423, 389480, 389481, 389488, 389489, 389490, 389491, 389506, 389507, 389508, 389511, 389512, 389513, 389515, 389573, 389576, 389579, 389580, 389581, 389583, 389584, 389593, 389594, 389596, 389656, 389657, 389659, 389671, 389672, 389673, 389674, 389675, 389846, 389849, 389850, 389851, 389853, 389861, 389862, 389863, 389864, 389865, 389866, 389867, 389868, 389869, 389870, 389871, 389944, 389945, 389946, 389947, 389948, 389949, 389950, 389951, 390040, 390041, 390044, 390045, 390047, 390048, 390049, 390058, 390059, 390060, 390062, 390063, 390119, 390120, 390121, 390122, 390123, 390124, 390142, 390143, 390144, 390145, 390148, 390206, 390207, 390210, 390226, 390227, 390231, 390232, 390289, 390290, 390291, 390302, 390303, 390304, 390305, 390306, 390307, 391616, 391617, 391618, 391619, 391621, 391622, 391623, 391624, 391625, 391626, 391627, 391713, 391714, 391715, 391716, 391718, 391719, 391720, 391721, 391722, 391723, 391725, 391726, 391727, 391788, 391789, 391790, 391791, 391793, 391813, 391814, 391816, 391817, 391818, 391819, 391820, 392064, 392067, 392073, 392074, 392075, 392076, 392077, 392123, 392125, 392126, 392209, 392210, 392211, 392274, 392276, 392279, 392281, 392362, 392896, 392970, 393120, 393121, 393122, 393124, 393125, 393339, 393347, 393348, 393349, 393350, 393351, 393352, 393353, 393355, 393358, 393360, 393361, 393362, 393363, 393364, 393367, 393675, 393676, 393683, 393685, 393686, 393689, 393690, 393691, 393692, 393743, 393744, 393745, 393747, 393749, 393752, 393754, 393755, 393757, 393759, 393761, 393762, 393765, 393766, 393767, 393770, 393875, 393876, 393877, 393878, 393880, 393881, 393883, 393885, 393886, 393890, 393943, 393944, 393947, 393948, 393949, 393950, 393953, 394007, 394009, 394011, 394015, 394018, 394019, 394469, 394474, 394475, 394579, 394768, 394770, 394787, 394850, 394851, 394875, 394946, 394947, 394963, 394964, 395225, 395232, 395248, 395249, 395328, 395422, 395481, 395483, 395495, 395496, 395502, 395570, 395571, 395578, 395579, 395582, 395658, 395659, 395666, 395672, 395724, 395725, 395726, 395730, 395807, 395808, 395894, 395955, 395956, 395960, 395961, 395963, 395965, 395966, 395967, 395969, 395970, 396044, 396144, 396145, 396146, 396151, 396152, 396153, 396154, 396158, 396566, 396572, 396649, 396650, 396742, 396848, 396861, 396862, 396865, 396871, 396886, 396962, 396974, 396981, 396987, 397064, 397066, 397071, 397078, 397084, 397085, 397086, 397158, 397159, 397175, 397267, 397268, 397269, 397270, 397271, 397272, 397273, 397274, 397275, 397276, 397277, 397278, 397364, 397365, 397372, 397373, 397374, 397376, 397378, 397381, 397382, 404695, 404772, 406931, 407125, 407136, 407137, 412489, 413372, 413376, 413377, 413387, 413388, 413389, 413390, 413394, 413395, 413420, 413421, 415559, 415633, 416958, 419398, 419475, 420610, 420611, 420684, 420697, 420698, 420701, 420703, 420705, 420710, 420711, 420714, 420783, 420795, 420943, 420944, 420945, 420951, 420956, 420957, 420965, 420966, 421046, 421047, 421051, 421057, 421060, 421065, 428059, 428062, 428069, 428072]

df_stupid = df.loc[df.unseq.isin(stupid_unseqs)]

for i,row in df_stupid.iterrows():
    unseq = int(row['unseq'])
    print(f'/STER/karansinghd/P28_cr_2022/00{unseq}_HRF_OBJ_ext_CosmicsRemoved_log_merged_cr.fits')

    cfits = fits.open(f'{cpath}/{row["object"]}/00{unseq}_HRF_OBJ_ext_CosmicsRemoved_log_merged_c.fits')

    crfits = fits.open(f'/STER/karansinghd/P28_cr_2022/00{unseq}_HRF_OBJ_ext_CosmicsRemoved_log_merged_cr.fits')

    utc = cfits[0].header['UTC']
    crfits[0].header.set('UTC',utc,'UTC start in seconds')


    crfits.writeto(f'/STER/karansinghd/P28_cr_2022/00{unseq}_HRF_OBJ_ext_CosmicsRemoved_log_merged_cr.fits', overwrite=True)
